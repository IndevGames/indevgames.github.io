<style>
/* --- PORTFOLIO ANIMATION STYLES --- */
#portfolio-posts {
  position: relative;
  overflow: hidden;
}

.portfolio-page {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  width: 100%;
  transition: transform 0.4s ease-in-out;
}

/* --- 3 columns layout (desktop) --- */
.portfolio-item {
  /* stays a flex item of .portfolio-page (display property doesn't affect flex membership),
     but we default to not showing items (display: none) so only visible ones occupy space */
  flex: 0 0 calc(33.333% - 20px);
  max-width: calc(33.333% - 20px);

  /* hidden by default so they don't take layout space */
  display: none;
  opacity: 0;
  transition: opacity 0.25s ease;
}

/* visible items: occupy layout and fade in */
.portfolio-item.visible {
  display: block;        /* remove from layout hiding */
  opacity: 1;            /* fade-in effect */
}

/* --- Mobile adjustments (still 3 columns for uniformity) --- */
@media (max-width: 768px) {
  .portfolio-item {
    flex: 0 0 calc(33.333% - 10px);
    max-width: calc(33.333% - 10px);
  }

  .portfolio-page {
    gap: 10px;
  }

  .portfolio-item img {
    width: 100%;
    height: auto;
    border-radius: 6px;
  }
}

/* --- Pagination Buttons --- */
.portfolio-page-btn {
  margin: 4px;
  padding: 8px 14px;
  border: none;
  background: #ccc;
  color: #333;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.25s ease-in-out;
  font-weight: 500;
}

.portfolio-page-btn:hover {
  background: #0056b3;
  color: #fff;
}

.portfolio-page-btn.active {
  background: #007bff;
  color: #fff;
}

/* Keep active button same blue â€” prevent dark blue when focused or clicked */
.portfolio-page-btn.active:hover,
.portfolio-page-btn.active:focus,
.portfolio-page-btn.active:active {
  background: #007bff !important;
  color: #fff !important;
  outline: none;
}

/* Remove focus outline and prevent focus color changes for all buttons */
.portfolio-page-btn:focus,
.portfolio-page-btn:active {
  outline: none;
  box-shadow: none;
  background: inherit;
}

/* Optional: reduce bottom margin of the container so there's no extra gap */
#portfolio .container {
  margin-bottom: 0;
  padding-bottom: 0;
}
</style>

<!-- Portfolio Grid Section -->
<section id="portfolio">
  <div class="container portfolio-flex-grid">
    <div class="row">
      <div class="col-lg-12 text-center">
        <h2>Portfolio</h2>
        <hr class="star-primary">
      </div>
    </div>

    <!-- Portfolio items -->
    <div id="portfolio-posts">
      <div class="portfolio-page" id="portfolio-page-container">
        {% for post in site.posts %}
        <div class="portfolio-flex-item portfolio-item">
          <a href="#portfolioModal-{{ post.modal-id }}" class="portfolio-link" data-toggle="modal">
            <div class="caption">
              <div class="caption-content">
                <i class="fa fa-search-plus fa-3x"></i>
              </div>
            </div>
            <img src="img/portfolio/{{ post.img }}" class="img-responsive" alt="{{ post.alt }}">
          </a>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Pagination Buttons -->
    <div class="pagination-container text-center" id="pagination"></div>
  </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const posts = Array.from(document.querySelectorAll("#portfolio-posts .portfolio-item"));
  const pageContainer = document.getElementById("portfolio-page-container");
  const pagination = document.getElementById("pagination");
  const perPage = 6; // 3 columns x 2 rows
  const total = posts.length;
  const totalPages = Math.ceil(total / perPage);
  let currentPage = 1;
  let animating = false;

  function showPage(page, direction = 0) {
    if (page < 1 || page > totalPages || animating) return;
    animating = true;

    const offset = direction * 100;
    pageContainer.style.transform = `translateX(${offset}%)`;

    setTimeout(() => {
      // Hide all (display: none) then mark visible ones (display:block)
      posts.forEach((post, i) => {
        const isVisible = (i >= (page - 1) * perPage && i < page * perPage);
        if (isVisible) {
          post.classList.add("visible");
        } else {
          post.classList.remove("visible");
        }
      });

      // reset transform and animate slide-in
      pageContainer.style.transition = "none";
      pageContainer.style.transform = `translateX(${-offset}%)`;
      void pageContainer.offsetWidth; // reflow
      pageContainer.style.transition = "transform 0.4s ease-in-out";
      pageContainer.style.transform = "translateX(0)";

      // update buttons
      document.querySelectorAll(".portfolio-page-btn").forEach((btn, idx) => {
        btn.classList.toggle("active", idx + 1 === page);
      });

      currentPage = page;
      setTimeout(() => animating = false, 400);
    }, 50);
  }

  // build pagination
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.className = "portfolio-page-btn";
    btn.addEventListener("click", () => {
      const direction = i > currentPage ? -1 : 1;
      showPage(i, direction);
      btn.blur(); // remove focus so it doesn't affect style
    });
    pagination.appendChild(btn);
  }

  // touch swipe (mobile)
  const swipeArea = document.getElementById("portfolio-posts");
  let startX = 0;
  swipeArea.addEventListener("touchstart", (e) => startX = e.touches[0].clientX);
  swipeArea.addEventListener("touchend", (e) => {
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;
    if (Math.abs(diff) > 50) {
      if (diff < 0 && currentPage < totalPages) showPage(currentPage + 1, -1);
      else if (diff > 0 && currentPage > 1) showPage(currentPage - 1, 1);
    }
  });

  // show initial page
  showPage(1);
});
</script>
